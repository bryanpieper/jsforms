/*!
 * Django jsforms jQuery plugin
 * http://www.thepiepers.net/
 *
 * This plugin enables the JSON integration between the Django forms and the frontend.
 * 
 * Usage:
 *  <script type="text/javascript">
 *   $("form").jsform();
 *  </script>
 *
 * Copyright (c) 2011, Bryan Pieper
 * Released under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 */
(function(e){e.fn.jsform=function(i){var a={method:"POST",async:false,dataType:"json",url:undefined,cache:false,loaderElement:undefined,requestSuccess:undefined,requestError:undefined,data:function(c){return c.serialize()},preSubmit:function(){},errorHandler:undefined,successHandler:undefined};return this.each(function(){i&&e.extend(a,i);var c=e(this),j=a.url!==undefined?a.url:c.attr("action");j||typeof console!=="undefined"&&console.log("Form does not have an 'action' attribute");var g={e:a.loaderElement,
show:function(){this.e&&e(this.e).show()},hide:function(){this.e&&e(this.e).fadeOut("fast")}};c.submit(function(){g.show();typeof a.preSubmit!=="undefined"&&a.preSubmit(c);var m=a.data(c);e.ajax({url:j,success:function(b){if(typeof a.errorHandler==="undefined"){c.children(".error").removeClass("error").find("ul").remove();c.children("ul.errorlist").remove()}if(typeof b.errors!=="undefined"&&b.errors)if(typeof a.errorHandler==="undefined")for(var d in b.errors){for(var k=b.errors,f=document.createElement("ul"),
h=0;h<k[d].length;h++){var l=document.createElement("li");l.innerHTML=k[d][h];f.appendChild(l)}if(d=="__all__"){f.className="errorlist";c.children().first().before(f)}else c.children("."+d).addClass("error").children("label").before(f)}else for(d in b.errors)a.errorHandler(d,b.errors[d]);else if(typeof a.successHandler==="undefined"){if(typeof b.redirect&&b.redirect)window.location.href=b.redirect}else a.successHandler(b);typeof a.requestSuccess!=="undefined"&&a.requestSuccess(b);g.hide()},error:function(b){g.hide();
typeof a.requestError!=="undefined"&&a.requestError(b)},async:a.async,dataType:a.dataType,data:m,type:a.method,cache:a.cache});return false})})}})(jQuery);