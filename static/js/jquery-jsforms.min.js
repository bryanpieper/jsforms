/*!
 * Django jsforms jQuery plugin
 * http://www.thepiepers.net/
 *
 * This plugin enables the JSON integration between the Django forms and the frontend.
 * 
 * Usage:
 *  <script type="text/javascript">
 *   $("form").jsform();
 *  </script>
 *
 * Copyright (c) 2011, Bryan Pieper
 * Released under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 */
(function(b){b.fn.jsform=function(e){var a={method:"POST",async:!0,dataType:"json",url:void 0,cache:!1,loaderElement:void 0,requestSuccess:void 0,requestError:void 0,data:function(a){return a.serialize()},preSubmit:function(){},errorHandler:void 0,successHandler:void 0};return this.each(function(){e&&b.extend(a,e);var f=b(this),j=a.url!==void 0?a.url:f.attr("action");j||typeof console!=="undefined"&&console.log("Form does not have an 'action' attribute");var h={e:a.loaderElement,show:function(){this.e&&
b(this.e).show()},hide:function(){this.e&&b(this.e).fadeOut("fast")}};f.submit(function(){h.show();var d=b(this);typeof a.preSubmit!=="undefined"&&a.preSubmit(d);var e=a.data(d);b.ajax({url:j,success:function(c){typeof a.errorHandler==="undefined"&&(d.find(".error").removeClass("error").find("ul").remove(),d.find("ul.errorlist").remove());typeof a.requestSuccess!=="undefined"&&a.requestSuccess(c);if(typeof c.errors!=="undefined"&&c.errors){if(typeof a.errorHandler==="undefined")for(var b in c.errors){for(var e=
c.errors,g=document.createElement("ul"),i=0;i<e[b].length;i++){var f=document.createElement("li");f.innerHTML=e[b][i];g.appendChild(f)}b=="__all__"?(g.className="errorlist",d.children().first().before(g)):d.find("."+b).addClass("error").children("label").before(g)}else for(b in c.errors)a.errorHandler(b,c.errors[b]);d.find(".error input:first").focus()}else typeof a.successHandler==="undefined"?typeof c.redirect&&c.redirect&&setTimeout(function(){window.location.href=c.redirect},300):a.successHandler(c);
h.hide()},error:function(c){h.hide();d.find(".error").removeClass("error").find("ul").remove();d.find("ul.errorlist").remove();typeof a.requestError!=="undefined"?a.requestError(c):(b("#req-error").remove(),d.first().before("<p id='req-error' class='error request-error'>We were unable to process the request  due to a server error. If this error persists, please contact us.</p>"))},async:a.async,dataType:a.dataType,data:e,type:a.method,cache:a.cache});return!1})})}})(jQuery);